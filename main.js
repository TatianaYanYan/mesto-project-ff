(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),document._escapeHandler||(document._escapeHandler=r,document.addEventListener("keydown",document._escapeHandler))}function t(e){e.classList.remove("popup_is-opened"),document._escapeHandler&&!document.querySelectorAll(".popup.popup_is-opened").length&&(document.removeEventListener("keydown",document._escapeHandler),delete document._escapeHandler)}function r(e){if("Escape"===e.key){var r=document.querySelector(".popup.popup_is-opened");r&&t(r)}}var n={baseUrl:"https://nomoreparties.co/v1/wff-cohort-41",headers:{authorization:"1320da65-2a44-4da9-ac47-53e70b13e145","Content-Type":"application/json"}};function o(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var u=document.querySelector("#card-template").content;function a(e,t,r,n,o){var a,c=u.querySelector(".card").cloneNode(!0),i=c.querySelector(".card__image"),p=c.querySelector(".card__title"),l=c.querySelector(".card__delete-button"),s=c.querySelector(".card__like-button"),d=c.querySelector(".card__like-counter");return i.src=e.link,i.alt=e.name,p.textContent=e.name,d.textContent=(null===(a=e.likes)||void 0===a?void 0:a.length)||0,e.likes.some(function(e){return e._id===t})&&s.classList.add("card__like-button_is-active"),e.owner._id!==t?l.remove():l.addEventListener("click",function(){return r(e,c)}),i.addEventListener("click",function(){return n(e.link,e.name)}),s.addEventListener("click",function(){return o(e,t,s,d)}),c}function c(e,t){var r;(r=e._id,fetch("".concat(n.baseUrl,"/cards/").concat(r),{method:"DELETE",headers:n.headers}).then(o)).then(function(){t.remove()}).catch(function(e){return console.error("Не удалось удалить карточку:",e)})}function i(e,t,r,u){var a,c=r.classList.contains("card__like-button_is-active");(c?(a=e._id,fetch("".concat(n.baseUrl,"/cards/likes/").concat(a),{method:"DELETE",headers:n.headers}).then(o)):function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:n.headers}).then(o)}(e._id)).then(function(e){r.classList.toggle("card__like-button_is-active",!c),u.textContent=e.likes.length}).catch(function(e){return console.error("Не удалось обновить лайк:",e)})}function p(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return l(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function s(e,t,r){return new RegExp(t).test(e.trim())?null:r}var d="Введите адрес сайта";function _(e){var t=Array.from(e.querySelectorAll(".popup__input")).some(function(e){return!e.checkValidity()}),r=e.querySelector(".popup__button");t?(r.classList.add("popup__button_disabled"),r.disabled=!0):(r.classList.remove("popup__button_disabled"),r.disabled=!1)}function f(e,t){var r=e.querySelectorAll(t.inputSelector),n=e.querySelector(t.submitButtonSelector);r.forEach(function(r){var n=e.querySelector("#".concat(r.id,"-error"));r.classList.remove(t.inputErrorClass),n.textContent="",n.classList.remove(t.errorClass),r.setCustomValidity("")}),n.classList.add(t.inactiveButtonClass),n.disabled=!0}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var m={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};!function(e){document.querySelectorAll(e.formSelector).forEach(function(e){!function(e){var t=e.querySelectorAll(".popup__input"),r={popup__input_type_name:/^[a-zA-Zа-яА-ЯёЁ\- ]+$/,popup__input_type_description:/^[a-zA-Zа-яА-ЯёЁ\- ]+$/,"popup__input_type_card-name":/^[a-zA-Zа-яА-ЯёЁ\- ]+$/,popup__input_type_url:/^https?:\/\/[^\s]+$/i,"popup__input_type_avatar-url":/^https?:\/\/[^\s]+$/i};t.forEach(function(t){var n=p(t.classList).find(function(e){return e.startsWith("popup__input_type_")});r[n]&&(t.pattern=r[n].source,(n.includes("name")||n.includes("description"))&&(t.dataset.error="Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы",t.setAttribute("minlength",2),t.setAttribute("maxlength",n.includes("name")?40:200)),(n.includes("url")||n.includes("avatar-url"))&&(t.type="url",t.dataset.requiredMessage=d)),t.addEventListener("input",function(){var n=p(t.classList).find(function(e){return e.startsWith("popup__input_type_")});if(r[n]){var o=s(t.value,r[n],t.dataset.error||d);t.setCustomValidity(o||"")}(function(e,t){var r=e.querySelector("#".concat(t.id,"-error")),n=function(e){if(e.validity.valueMissing)return e.dataset.requiredMessage||"Вы пропустили это поле";if(e.validity.tooShort)return t=e.minLength,r=e.value.length,"Минимальное количество символов ".concat(t,". Длина текста сейчас: ").concat(r," символ").concat(1!==r?"а":"");var t,r;if("url"===e.type&&!s(e.value,/^https?:\/\/[^\s]+$/i,d))return d;if(e.dataset.error){var n=e.pattern?new RegExp(e.pattern):null;if(n&&!n.test(e.value.trim()))return e.dataset.error}return""}(t);n?(t.classList.add("popup__input_type_error"),r.textContent=n,r.classList.add("popup__error_visible")):(t.classList.remove("popup__input_type_error"),r.textContent="",r.classList.remove("popup__error_visible"))})(e,t),_(e)})}),e.addEventListener("submit",function(e){e.preventDefault();var r=p(t).find(function(e){return!e.checkValidity()});r&&r.focus()})}(e),_(e)})}(m);var v=document.querySelector(".places__list"),h=document.querySelector(".popup.popup_type_edit"),b=h.querySelector('.popup__form[name="edit-profile"]'),S=document.querySelector(".profile__title"),q=document.querySelector(".profile__description"),g=document.querySelector(".profile__image"),C=document.querySelector(".popup.popup_type_new-card"),E=C.querySelector('.popup__form[name="new-place"]'),L=document.querySelector(".popup.popup_type_update-avatar"),k=L.querySelector('.popup__form[name="update-avatar"]');function A(t,r){var n=document.querySelector(".popup.popup_type_image"),o=n.querySelector(".popup__image"),u=n.querySelector(".popup__caption");o.src=t,o.alt=r,u.textContent=r,e(n)}b.addEventListener("submit",function(e,t,r,u){return function(a){a.preventDefault(),f(b,m);var c,i,p=a.target.querySelector(".popup__input_type_name"),l=a.target.querySelector(".popup__input_type_description"),s=p.value,d=l.value,_=a.target.querySelector(".popup__button"),y=_.textContent;_.textContent="Сохранение...",(c=s,i=d,fetch("".concat(n.baseUrl,"/users/me"),{method:"PATCH",headers:n.headers,body:JSON.stringify({name:c,about:i})}).then(o)).then(function(n){e.textContent=n.name,t.textContent=n.about,u(r)}).catch(function(e){return console.error("Не удалось сохранить данные:",e)}).finally(function(){_.textContent=y})}}(S,q,h,t)),E.addEventListener("submit",function(e,t,r,u,a,c,i,p){return function(l){l.preventDefault(),f(t,m);var s,d,_=t.querySelector(".popup__input_type_card-name"),y=t.querySelector(".popup__input_type_url"),v={name:_.value,link:y.value},h=l.target.querySelector(".popup__button"),b=h.textContent;h.textContent="Сохранение...",(s=v.name,d=v.link,fetch("".concat(n.baseUrl,"/cards"),{method:"POST",headers:n.headers,body:JSON.stringify({name:s,link:d})}).then(o)).then(function(n){var o=a(n,window.userId,c,i,p);e.prepend(o),t.reset(),f(t,m),u(r)}).catch(function(e){return console.error("Не удалось добавить карточку:",e)}).finally(function(){h.textContent=b})}}(v,E,C,t,a,c,A,i)),k.addEventListener("submit",function(e,t,r,u){return function(a){a.preventDefault(),f(k,m);var c,i=t.querySelector(".popup__input_type_avatar-url").value,p=t.querySelector(".popup__button"),l=p.textContent;p.textContent="Сохранение...",(c=i,fetch("".concat(n.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:n.headers,body:JSON.stringify({avatar:c})}).then(o)).then(function(n){e.style.backgroundImage="url(".concat(n.avatar,")"),u(r),t.reset(),f(k,m)}).catch(function(e){return console.error("Не удалось обновить аватар:",e)}).finally(function(){p.textContent=l})}}(g,k,L,t)),function(){var r=document.querySelector(".popup.popup_type_edit"),n=document.querySelector(".profile__edit-button"),o=document.querySelector(".popup.popup_type_new-card"),u=document.querySelector(".profile__add-button");n.addEventListener("click",function(){var t=r.querySelector(".popup__input_type_name"),n=r.querySelector(".popup__input_type_description");t.value=S.textContent,n.value=q.textContent,f(b,m),e(r)}),u.addEventListener("click",function(){e(o),E.reset(),f(E,m)}),g.addEventListener("click",function(){e(L)}),document.querySelectorAll(".popup__close").forEach(function(e){e.addEventListener("click",function(e){var r=e.target.closest(".popup");r&&t(r)})}),document.querySelectorAll(".popup_is-animated").forEach(function(e){e.addEventListener("click",function(e){e.target===e.currentTarget&&t(e.currentTarget)})})}(),Promise.all([fetch("".concat(n.baseUrl,"/users/me"),{method:"GET",headers:n.headers}).then(o),fetch("".concat(n.baseUrl,"/cards"),{method:"GET",headers:n.headers}).then(o)]).then(function(e){var t,r,n=(r=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,u,a,c=[],i=!0,p=!1;try{if(u=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;i=!1}else for(;!(i=(n=u.call(r)).done)&&(c.push(n.value),c.length!==t);i=!0);}catch(e){p=!0,o=e}finally{try{if(!i&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(p)throw o}}return c}}(t,r)||function(e,t){if(e){if("string"==typeof e)return y(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=n[0],u=n[1];window.userId=o._id,S.textContent=o.name,q.textContent=o.about,g.style.backgroundImage="url(".concat(o.avatar,")"),u.forEach(function(e){var t=a(e,o._id,c,A,i);v.appendChild(t)})}).catch(function(e){console.error("Произошла ошибка:",e)})})();
//# sourceMappingURL=main.js.map